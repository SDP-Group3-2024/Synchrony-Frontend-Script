(()=>{"use strict";function t(t){console.log(`${t.event_type} event:`,JSON.stringify(t,null,2)),fetch("https://kyoh9ri6zj.execute-api.us-east-1.amazonaws.com/dev/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch((t=>console.error("Error sending log data:",t)))}function e(t,e){return{event_type:t,timestamp:(new Date).toISOString(),session_id:e,page_url:window.location.href,page_path:window.location.pathname,page_title:document.title}}class i{constructor(t){this.session_id=t}setup(){const i=()=>{t(e("page_exit",this.session_id))};window.addEventListener("beforeunload",(t=>{i(),t.preventDefault(),t.returnValue=""})),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&i()}))}}class s{constructor(t){this.session_id=t,this.dataAttribute="data-analytics-id",this.dataCategory="data-analytics-category",this.dataAction="data-analytics-action"}setup(){document.addEventListener("click",(i=>{var s;const n=i.target;if(!n)return;const o=this.findAnalyticsAttribute(n,this.dataAttribute),a=this.findAnalyticsAttribute(n,this.dataCategory),r=this.findAnalyticsAttribute(n,this.dataAction),c=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e("click",this.session_id)),{element_tag:n.tagName.toLowerCase(),element_id:n.id||void 0,element_class:n.className||void 0,element_text:(null===(s=n.textContent)||void 0===s?void 0:s.substring(0,50))||void 0,x_position:i.clientX,y_position:i.clientY}),o&&{analytics_id:o}),a&&{category:a}),r&&{action:r});console.log(o,a,r),t(c)}))}findAnalyticsAttribute(t,e){let i=t;for(;i&&i!==document.body;){const t=i.getAttribute(e);if(t)return t;i=i.parentElement}}}class n{constructor(t){this.session_id=t,this.scrollTimeout=null,this.scrollThrottle=500,this.lastScrollPosition=window.scrollY}setup(){window.addEventListener("scroll",(()=>{this.scrollTimeout||(this.scrollTimeout=window.setTimeout((()=>{const i=window.scrollY,s=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),n=window.innerHeight,o=Math.round(i/(s-n)*100),a=Object.assign(Object.assign({},e("scroll",this.session_id)),{scroll_depth:o,scroll_direction:i>this.lastScrollPosition?"down":"up",viewport_height:n,document_height:s});this.lastScrollPosition=i,t(a),this.scrollTimeout=null}),this.scrollThrottle))}),{passive:!0})}}class o{constructor(t){this.session_id=t}setup(){"complete"===document.readyState?this.trackPerformance():window.addEventListener("load",(()=>this.trackPerformance()))}trackPerformance(){if(!window.performance)return;const i=Object.assign(Object.assign({},e("performance",this.session_id)),{load_time:performance.now(),dom_interactive_time:this.getNavigationTiming("domInteractive"),dom_complete_time:this.getNavigationTiming("domComplete")});this.addWebVitals(i),t(i)}getNavigationTiming(t){const e=performance.getEntriesByType("navigation")[0];if(!e)return 0;const i=e.startTime,s=e[t];return s?s-i:0}addWebVitals(t){const e=performance.getEntriesByName("first-contentful-paint")[0];e&&(t.first_contentful_paint=e.startTime);const i=performance.getEntriesByName("largest-contentful-paint")[0];i&&(t.largest_contentful_paint=i.startTime);const s=performance.getEntriesByName("first-input-delay")[0];s&&(t.first_input_delay=s.duration);const n=performance.getEntriesByName("cumulative-layout-shift")[0];n&&(t.cumulative_layout_shift=n.duration)}}class a{constructor(t){this.session_id=t}setup(){window.addEventListener("error",(i=>{var s,n;t(Object.assign(Object.assign({},e("error",this.session_id)),{error_message:i.message||"Unknown error",error_source:i.filename,error_line:i.lineno,error_column:i.colno,error_stack:null===(s=i.error)||void 0===s?void 0:s.stack,error_type:(null===(n=i.error)||void 0===n?void 0:n.name)||"Error"}))})),window.addEventListener("unhandledrejection",(i=>{let s,n,o="Promise Rejection";if(i.reason instanceof Error)s=i.reason.message,n=i.reason.stack,o=i.reason.name;else if("string"==typeof i.reason)s=i.reason;else try{s=JSON.stringify(i.reason)}catch(t){s="Unhandled Promise Rejection"}t(Object.assign(Object.assign({},e("error",this.session_id)),{error_message:s,error_stack:n,error_type:o}))}))}}class r{constructor(t,e=6e4,i=6e4){this.session_id=t,this.lastActivityTime=Date.now(),this.isIdle=!1,this.totalActiveTime=0,this.totalIdleTime=0,this.pageLoadTime=Date.now(),this.idleThreshold=e,this.activityReportInterval=i}setup(){["mousedown","keydown","touchstart","scroll"].forEach((t=>{document.addEventListener(t,(()=>{this.isIdle&&(this.isIdle=!1,this.totalIdleTime+=Date.now()-this.lastActivityTime),this.lastActivityTime=Date.now()}),{passive:!0})})),setInterval((()=>{const t=Date.now();!this.isIdle&&t-this.lastActivityTime>this.idleThreshold&&(this.isIdle=!0,this.lastActivityTime=t)}),5e3),setInterval((()=>{const i=Date.now(),s=i-this.pageLoadTime;this.isIdle?(this.totalIdleTime+=i-this.lastActivityTime,this.lastActivityTime=i):this.totalActiveTime=s-this.totalIdleTime;const n=Object.assign(Object.assign({},e("activity",this.session_id)),{time_on_page:Math.floor(s/1e3),idle_time:Math.floor(this.totalIdleTime/1e3),active_time:Math.floor(this.totalActiveTime/1e3)});console.log(n),t(n)}),this.activityReportInterval)}}const c=new class{constructor(){this.session_id=sessionStorage.getItem("session_id")||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),sessionStorage.setItem("session_id",this.session_id),this.trackers={exit:new i(this.session_id),click:new s(this.session_id),scroll:new n(this.session_id),performance:new o(this.session_id),error:new a(this.session_id),activity:new r(this.session_id)}}initialize(){Object.values(this.trackers).forEach((t=>t.setup())),console.log("Analytics tracking initialized with session ID:",this.session_id)}trackEvent(i,s){t(Object.assign(Object.assign({},e(i,this.session_id)),s))}};c.initialize(),window.analyticsTracker=c})();